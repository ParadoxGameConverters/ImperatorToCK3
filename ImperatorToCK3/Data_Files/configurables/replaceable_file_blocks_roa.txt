# This file contains blocks from Rajas of Asia files that can be replaced with new ones.
# The structure is as follows:

# <file name> = {
# 	replace = {
# 		before = {
# 			some original code			
# 		}
# 		after = {
# 			some modified code			
# 		}
# 	}
#
# 	replace = {
# 		before = {
# 			some original code 2		
# 		}
# 		after = {
# 			some modified code 2		
# 		}
# 	}
# }

# INDENTATION IS IMPORTANT INSIDE the before BLOCK!
# ASIDE FROM THE CURLY BRACKETS SURROUNDING THE BLOCK, IT MUST MATCH THE ORIGINAL FILE.
# OTHERWISE THE BLOCKS WON'T BE MODIFIED!


"common/script_values/ccu_culture_values.txt" = {
	# Fix RoA's CCU system to actually use language groups/families/unions
	replace = {
		before = {
		# Increase base acceptance for sharing same language
		if = {
			limit = {
				has_same_culture_language = scope:culture
			}
			add = {
				value = 10 # please update CULTURE_PILLAR_TOOLTIP_LANGUAGE_EFFECT if this number changes
				desc = ACCEPTANCE_BASELINE_LANGUAGE
			}
		}
		} # end of before

		after = {
		# Increase base acceptance for sharing same language
		if = {
			limit = {
				has_same_culture_language = scope:culture
			}
			add = {
				value = 10 # please update CULTURE_PILLAR_TOOLTIP_LANGUAGE_EFFECT if this number changes
				desc = ACCEPTANCE_BASELINE_LANGUAGE
			}
		}
		else_if = {
			limit = { has_same_language_group_as = { TARGET = scope:culture } }
			add = {
				value = same_language_group_cultural_acceptance
				desc = ACCEPTANCE_BASELINE_LANGUAGE_GROUP
			}
		}
		else_if = {
			limit = { has_same_language_family_as = { TARGET = scope:culture } }
			add = {
				value = same_language_family_cultural_acceptance
				desc = ACCEPTANCE_BASELINE_LANGUAGE_FAMILY
			}
		}
		else_if = {
			limit = { is_in_language_union_with = { TARGET = scope:culture } }
			add = {
				value = same_language_union_cultural_acceptance
				desc = ACCEPTANCE_BASELINE_LANGUAGE_UNION
			}
		}
		} # end of after
	}
} # end of ccu_culture_values block

"common/decisions/dlc_decisions/bp3/sea_bp3_other_decisions.txt" = {
	# In form_bosporan_kingdom_decision, make sure the kingdom doesn't have a holder or de jure land.
	replace = {
		before = {
	is_shown = {
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_bosporan_kingdom
			}
		}
		culture = {
			OR = {
				has_cultural_pillar = heritage_central_germanic
				has_cultural_pillar = heritage_byzantine
			}
		}
		highest_held_title_tier <= tier_kingdom
		any_held_title = {
			OR = {
				de_jure_liege = title:d_crimea
				de_jure_liege = title:d_azov
				de_jure_liege = title:d_tmutarakan
				this = title:d_crimea
				this = title:d_azov
				this = title:d_tmutarakan
			}
		}
	}
		} # end of before
		
		after = {
	is_shown = {
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_bosporan_kingdom
			}
		}
		culture = {
			OR = {
				has_cultural_pillar = heritage_central_germanic
				has_cultural_pillar = heritage_byzantine
			}
		}
		highest_held_title_tier <= tier_kingdom
		any_held_title = {
			OR = {
				de_jure_liege = title:d_crimea
				de_jure_liege = title:d_azov
				de_jure_liege = title:d_tmutarakan
				this = title:d_crimea
				this = title:d_azov
				this = title:d_tmutarakan
			}
		}
		# IRToCK3: "Added this just making sure the kingdom doesn't have a holder or de jure land" ~~tanner918
		title:k_bosporan_kingdom = {
			AND = {
				NOT = { exists = holder }
				any_de_jure_county = {
					count < 1
				}
			}
		}
	}
		} # end of after
	}
} # end of sea_bp3_other_decisions block

"common/on_action/government_assignment_on_actions.txt" = {
	# Adjust RoA's assignment of Stateless government so it is limited to the out-of-scope regions in Indonesia
	replace = {
		before = {
				limit = {
					has_government = tribal_government
					#is_independent_ruler = yes
					highest_held_title_tier <= tier_duchy
					culture = {
						OR = {
							AND = {
								has_cultural_tradition = tradition_collective_lands
								NOT = {
									this = culture:muong
									has_cultural_parameter = heritage_group_austronesian
									has_cultural_pillar = heritage_aghvank
								}
							}
							AND = {
								has_cultural_pillar = heritage_papuan
								NOT = { this = culture:sepik }
							}
							has_cultural_pillar = heritage_kaurareg
							this = culture:lhomon
							this = culture:aslian
							this = culture:motu
							this = culture:moklen
						}
					}
				}
		} # end of before

		after = {
				limit = {
					has_government = tribal_government
					#is_independent_ruler = yes
					highest_held_title_tier <= tier_duchy
					culture = {
						OR = {
							AND = {
								has_cultural_tradition = tradition_collective_lands
								NOT = {
									this = culture:muong
									has_cultural_parameter = heritage_group_austronesian
									has_cultural_pillar = heritage_aghvank
								}
							}
							AND = {
								has_cultural_pillar = heritage_papuan
								NOT = { this = culture:sepik }
							}
							has_cultural_pillar = heritage_kaurareg
							this = culture:lhomon
							this = culture:aslian
							this = culture:motu
							this = culture:moklen
						}
					}
					# Limit this to out-of-scope regions in Indonesia
					capital_province = {
						geographical_region = converter_roa_out_of_scope_region
					}
				}
		} # end of after
	}
} # end of government_assignment_on_actions block

"map_data/geographical_regions/geographical_region.txt" = {
	# Adds in the relevant region for the out-of-scope stateless assignment
	replace = {
		before = {
seasonal_region_west_africa = {
	regions = {
		world_africa_west sea_south_atlantic sea_macaronesia
	}
}
		} # end of before
		
		after = {
seasonal_region_west_africa = {
	regions = {
		world_africa_west sea_south_atlantic sea_macaronesia
	}
}

# For limiting the RoA stateless government assignment to regions out of scope of Terra-Indomita
converter_roa_out_of_scope_region = {
	regions = {
		world_mindanao world_kalimantan world_java world_timor world_sulawesi world_moluccas world_panua world_micronesia world_papua_new_guinea
	}
	duchies = {
		d_lupah_sug d_sugbu d_buglas d_masbat d_bo_ol d_east_bisaya

		d_palembang d_bangkahulu d_basemah d_lampung d_kerinci d_jambi d_bangka_belitung
	}
	counties = {
		c_ipolot c_oton c_dumangas c_inderapura
	}
}
		} # end of after
	}
} # end of geographical_region block


"common/scripted_triggers/00_law_triggers.txt" = {
	# Need to set this trigger to always be false so admin realms end up with the proper succession law
	replace = {
		before = {
non_roman_administrative_gov_trigger = {
	government_allows = administrative
	is_independent_ruler = yes
	primary_title = {
		NOR = {
			this = title:e_roman_empire
			this = title:e_byzantium
		}
	}
}
		}

		after = {
non_roman_administrative_gov_trigger = {
	always = no
}
		}
	}
}


"common\on_action\sea_game_start.txt" = {
	## Because of the way this file is formatted, to disable some of the game_start stuff, it is easier to just remove the calls to the specific on_actions this way
	replace = { # Begin on_game_start
		before = {
on_game_start = {
    on_actions = {
        # holy_site_buildings_on_game_start
        # holy_site_descriptions_on_game_start
        assign_nanzhao_state
        acculturate_steppelads
        #holy_site_fix
        lock_indo_greek
        EEE_sea_setup_on_actions
        fix_government_types
        #generate_shangshu
        nerf_japan
        misc_ROA_stuff

        # Optional admin realms via gamerules; PDX does it before and after lobby, so will we.
        sea_optional_admin_realms

        # update title CoAs
        sea_title_coa_on_start

        fragment_cumania
    }
}
		} # end of before

		after = {
on_game_start = {
    on_actions = {
        # holy_site_buildings_on_game_start
        # holy_site_descriptions_on_game_start
        #assign_nanzhao_state # IRToCK3: Disabled
        #acculturate_steppelads # IRToCK3: Disabled
        #holy_site_fix
        lock_indo_greek
        EEE_sea_setup_on_actions
        fix_government_types
        #generate_shangshu
        #nerf_japan # IRToCK3: Disabled
        #misc_ROA_stuff # IRToCK3: Disabled

        # Optional admin realms via gamerules; PDX does it before and after lobby, so will we.
        #sea_optional_admin_realms # IRToCK3: Disabled

        # update title CoAs
        #sea_title_coa_on_start # IRToCK3: Disabled

        #fragment_cumania # IRToCK3: Disabled
    }
}
		} # end of after
	} # End on_game_start


	replace = { # Begin on_game_start_after_lobby
		before = {
on_game_start_after_lobby = {
    on_actions = {
        #ruler_popup_events
        sea_set_cultural_acceptance
        on_yearly_assign_culture_faith
        sea_historical_artifacts
        set_tai_language
        # assign_varnas
        set_court_languages

        # Chinese gov setup
        sea_historical_chinese_vassal_contracts

        # Set
        sea_give_gunpowder_innos

        # 930 conquerors
        sea_936_conquerors

        # Optional admin realms via gamerules
        sea_optional_admin_realms
    }
}
		} # end of before

		after = {
on_game_start_after_lobby = {
    on_actions = {
        #ruler_popup_events
        #sea_set_cultural_acceptance # IRToCK3: Disabled
        on_yearly_assign_culture_faith
        #sea_historical_artifacts # IRToCK3: Disabled
        #set_tai_language # IRToCK3: Disabled
        # assign_varnas
        #set_court_languages # IRToCK3: Disabled

        # Chinese gov setup
        #sea_historical_chinese_vassal_contracts # IRToCK3: Disabled

        # Set
        #sea_give_gunpowder_innos # IRToCK3: Disabled

        # 930 conquerors
        #sea_936_conquerors # IRToCK3: Disabled

        # Optional admin realms via gamerules
        #sea_optional_admin_realms # IRToCK3: Disabled
    }
}
		} # end of after
	} # End on_game_start_after_lobby

} # End of sea_game_start.txt
