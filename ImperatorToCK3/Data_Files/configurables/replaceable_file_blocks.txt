# This file contains blocks from vanilla files that can be replaced with new ones.
# The structure is as follows:

# <file name> = {
# 	replace = {
# 		before = {
# 			some original code			
# 		}
# 		after = {
# 			some modified code			
# 		}
# 	}
#
# 	replace = {
# 		before = {
# 			some original code 2		
# 		}
# 		after = {
# 			some modified code 2		
# 		}
# 	}
# }

# INDENTATION IS IMPORTANT INSIDE the before BLOCK!
# ASIDE FROM THE CURLY BRACKETS SURROUNDING THE BLOCK, IT MUST MATCH THE ORIGINAL FILE.
# OTHERWISE THE BLOCKS WON'T BE MODIFIED!


"common/on_action/game_start.txt" = {
	# from error.log:
	# add_special_building_slot effect [ Province 'Salamanca' already has a special building slot ]
	replace = {
		before = {
		title:b_salamanca.title_province = { add_special_building_slot = generic_university }
		}

		after = {
		title:b_salamanca.title_province = {
			if = {
				limit = {
					has_special_building_slot = no
				}
				add_special_building_slot = generic_university
			}
		}
		}
	}

	# Base game assumes e_japan will always have a holder, changed to check if a holder exists at game start. Also made it so that if someone holds e_japan at game start, they also get k_chrysanthemum_throne, to make sure that gets handed out.
	replace = {
		before = {
				holder = {
					every_noble_family = {
						holder.house ?= {
							save_temporary_scope_as = house_temp
							every_house_member = {
								limit = {
									is_married = yes
									exists = primary_spouse.house
									NOT = {
										primary_spouse.house = { has_house_relation_with = scope:house_temp }
									}
								}
								save_temporary_scope_as = member_temp
								primary_spouse = { save_temporary_scope_as = spouse_temp }
								house = {
									change_house_relation_effect = {
										HOUSE = scope:member_temp.primary_spouse.house
										VALUE = house_relation_improve_minor_value
										REASON = preexisting_marriage
										CHAR = scope:member_temp
										TARGET_CHAR = scope:spouse_temp
										TITLE = scope:dummy_gender
									}
								}
							}
						}
					}
				}
		}

		after = {
				holder ?= {
					every_noble_family = {
						holder.house ?= {
							save_temporary_scope_as = house_temp
							every_house_member = {
								limit = {
									is_married = yes
									exists = primary_spouse.house
									NOT = {
										primary_spouse.house = { has_house_relation_with = scope:house_temp }
									}
								}
								save_temporary_scope_as = member_temp
								primary_spouse = { save_temporary_scope_as = spouse_temp }
								house = {
									change_house_relation_effect = {
										HOUSE = scope:member_temp.primary_spouse.house
										VALUE = house_relation_improve_minor_value
										REASON = preexisting_marriage
										CHAR = scope:member_temp
										TARGET_CHAR = scope:spouse_temp
										TITLE = scope:dummy_gender
									}
								}
							}
						}
					}

					# IRToCK3: Need to also give out k_chrysanthemum_throne
					save_scope_as = japan_emp
					create_title_and_vassal_change = {
						type = created
						save_scope_as = change
					}
					title:k_chrysanthemum_throne = {
						change_title_holder = {
							holder = scope:japan_emp
							change = scope:change
						}
						copy_title_history = title:e_japan
					}
					resolve_title_and_vassal_change = scope:change
				}
		}
	}
}


"common/decisions/dlc_decisions/bp3/00_bp3_other_decisions.txt" = {
	# In form_bosporan_kingdom_decision, make sure the kingdom doesn't have a holder or de jure land.
	replace = {
		before = {
	is_shown = {
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_bosporan_kingdom
			}
		}
		culture = {
			OR = {
				has_cultural_pillar = heritage_central_germanic
				has_cultural_pillar = heritage_byzantine
			}
		}
		highest_held_title_tier <= tier_kingdom
		any_held_title = {
			OR = {
				de_jure_liege = title:d_crimea
				de_jure_liege = title:d_azov
				this = title:d_crimea
				this = title:d_azov
			}
		}
	}
		} # end of before
		
		after = {
	is_shown = {
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_bosporan_kingdom
			}
		}
		culture = {
			OR = {
				has_cultural_pillar = heritage_central_germanic
				has_cultural_pillar = heritage_byzantine
			}
		}
		highest_held_title_tier <= tier_kingdom
		any_held_title = {
			OR = {
				de_jure_liege = title:d_crimea
				de_jure_liege = title:d_azov
				this = title:d_crimea
				this = title:d_azov
			}
		}
		# IRToCK3: "Added this just making sure the kingdom doesn't have a holder or de jure land" ~~tanner918
		title:k_bosporan_kingdom = {
			AND = {
				NOT = { exists = holder }
				any_de_jure_county = {
					count < 1
				}
			}
		}
	}
		} # end of after
	}
}


"common/decisions/dlc_decisions/ep3_decisions.txt" = {
	#########
	# recreate_byzantine_empire_decision
	#########
	
	# is_shown block
	replace = {
		before = {
		has_dlc_feature = roads_to_power
		NOR = {
			exists = title:e_byzantium.holder
			exists = title:h_roman_empire.holder
			exists = title:h_eastern_roman_empire.holder
		}
		title:e_byzantium = { is_titular = no }
		OR = {
			culture = {
				OR = {
					this = culture:greek
					any_parent_culture_or_above = { this = culture:greek }
				}
			}
			AND = {
				OR = {
					ep3_orthodox_faith_trigger = yes
					faith = faith:hellenic_pagan
				}
				primary_title = {
					tier <= tier_empire
					empire = title:e_latin_empire
				}
			}
			AND = {
				OR = {
					ep3_orthodox_faith_trigger = yes
					faith = faith:hellenic_pagan
				}
				primary_title = {
					tier <= tier_empire
					empire = title:e_byzantium
				}
			}
		}
		} # end of before
		
		after = {
		has_dlc_feature = roads_to_power
		exists = title:e_byzantium.previous_holder # IRToCK3: Make sure e_byzantium has a previous holder to ensure it existed previously (otherwise why would this decision even make sense?)
		NOR = {
			exists = title:e_byzantium.holder
			exists = title:h_roman_empire.holder
			exists = title:h_eastern_roman_empire.holder
		}
		# IRToCK3: Will always make sure the titles don't have holders, but if the Latin Empire doesn't have a holder (implying either the Splintered Crusade hasn't launched yet, or it has been finished and e_latin_empire was destroyed) then it should also make sure that the titles don't have any de jure land. If ERE has land, it could be formed the normal way, and if Rome has land, that should be the title formed, not the ERE
		trigger_if = {
			limit = {
				NOT = { exists = title:e_latin_empire.holder } # IRToCK3: Only need to check if it has a holder because once the title is broken/destroyed, all land is given back to e_byzantium
			}

			AND = {
				title:e_byzantium = {
					any_de_jure_county = {
						count < 1
					}
				}
				title:h_roman_empire = {
					any_de_jure_county = {
						count < 1
					}
				}
			}
		}
		OR = {
			# IRToCK3: Allow Romans to use this decision too
			culture = {
				OR = {
					this = culture:greek
					this = culture:roman
					any_parent_culture_or_above = { this = culture:greek }
					any_parent_culture_or_above = { this = culture:roman }
				}
			}
			AND = {
				OR = {
					ep3_orthodox_faith_trigger = yes
					faith = faith:hellenic_pagan
				}
				primary_title = {
					tier <= tier_empire
					empire = title:e_latin_empire
				}
			}
			AND = {
				OR = {
					ep3_orthodox_faith_trigger = yes
					faith = faith:hellenic_pagan
				}
				primary_title = {
					tier <= tier_empire
					empire = title:e_byzantium
				}
			}
		}
		} # end of after
	} # end of is_shown block

	# is_valid block
	replace = {
		before = {
		custom_tooltip = {
			NOT = {
				exists = title:e_byzantium.holder
			}
			text = no_byz_emp_exists_tt
		}
		top_liege = this
		OR = {
			custom_tooltip = {
				culture = {
					this = culture:greek
				}
				text = is_greek_tt
			}
			custom_tooltip = {
				culture = {
					any_parent_culture_or_above = { this = culture:greek }
				}
				text = is_greek_descendent_tt
			}
			ep3_orthodox_faith_trigger = yes
			faith = faith:hellenic_pagan
		}
		highest_held_title_tier >= tier_kingdom
		
		realm_size >= 12
		custom_tooltip = {
			title:c_byzantion.holder = {
				exists = this
				OR = {
					this = root
					AND = {
						is_ai = yes
						top_liege = root
					}
				}
			}
			text = pandidakterion_tt
		}
		primary_title = {
			tier <= tier_empire
			OR = {
				empire = title:e_latin_empire
				empire = title:e_byzantium
			}
		}
		trigger_if = {
			limit = {
				is_ai = no
				has_legitimacy = yes
			}
			legitimacy_level >= 3
		}
		#A liiiiiittle easier for AI
		trigger_if = {
			limit = {
				is_ai = yes
				has_legitimacy = yes
			}
			legitimacy_level >= 1
		}
		} # end of before
		
		after = {
		# IRToCK3: Can't have the WRE since they should focus on forming h_roman_empire
		NOT = { has_title = title:h_western_roman_empire }
		# IRToCK3: Show that e_byzantium and h_roman_empire can't have holders
		custom_tooltip = {
			NOR = {
				exists = title:e_byzantium.holder
				exists = title:h_roman_empire.holder
			}
			text = no_byz_emp_exists_tt
		}
		top_liege = this
		OR = {
			# IRToCK3: Allow Greeks OR Romans, or their descendent cultures, to take decision
			custom_tooltip = {
				culture = {
					OR = {
						this = culture:greek
						this = culture:roman
					}
				}
				text = is_greek_tt
			}
			custom_tooltip = {
				culture = {
					any_parent_culture_or_above = {
						OR = {
							this = culture:greek
							this = culture:roman
						}
					}
				}
				text = is_greek_descendent_tt
			}
			ep3_orthodox_faith_trigger = yes
			faith = faith:hellenic_pagan
		}
		highest_held_title_tier >= tier_kingdom
		
		# IRToCK3: Modified so that it only requires the normal 12 realm size if the Latin Empire exists so it uses those intended mechanics/conditions. Otherwise, if it doesn't exist, then that means it is just a normal Roman/Romaioi (greek) character trying to restore the empire, so making it a bit more on par with other empire restoration/creation decisions
		trigger_if = {
			limit = {
				exists = title:e_latin_empire.holder
			}

			realm_size >= 12
		}
		trigger_else = {
			realm_size >= 80
		}

		custom_tooltip = {
			title:c_byzantion.holder = {
				exists = this
				OR = {
					this = root
					AND = {
						is_ai = yes
						top_liege = root
					}
				}
			}
			text = pandidakterion_tt
		}
		# IRToCK3: Modified so that this condition is only checked if the Latin Empire exists (since that indicates the Splintered Crusade happened, so it should use those intended mechanics/conditions)
		trigger_if = {
			limit = {
				exists = title:e_latin_empire.holder
			}

			primary_title = {
				tier <= tier_empire
				OR = {
					empire = title:e_latin_empire
					empire = title:e_byzantium
				}
			}
		}
		trigger_if = {
			limit = {
				is_ai = no
				has_legitimacy = yes
			}
			legitimacy_level >= 3
		}
		#A liiiiiittle easier for AI
		trigger_if = {
			limit = {
				is_ai = yes
				has_legitimacy = yes
			}
			legitimacy_level >= 1
		}
		} # end of after
	} # end of is_valid block

	# cost block
	replace = {
		before = {
				if = {
					limit = {
						culture = {
							NOR = {
								this = culture:greek
								any_parent_culture_or_above = { this = culture:greek }
							}
						}
					}
					add = 500
				}
		} # end of before

		after = {
				if = {
					limit = {
						culture = {
							NOR = {
								# IRToCK3: Change the cost increase to non-greeks/romans
								this = culture:greek
								this = culture:roman
								any_parent_culture_or_above = { this = culture:greek }
								any_parent_culture_or_above = { this = culture:roman }
							}
						}
					}
					add = 500
				}
		} # end of after
	} # end of cost block

	# ai blocks
	replace = {
		before = {
	ai_potential = {
		NOT = { exists = title:e_byzantium.holder }
		any_held_title = {
			title_tier = kingdom
			OR = {
				empire = title:e_latin_empire
				empire = title:e_byzantium
			}
		}
		OR = {
			culture = {
				OR = {
					this = culture:greek
					any_parent_culture_or_above = { this = culture:greek }
				}
			}
			ep3_orthodox_faith_trigger = yes
			primary_title = {
				tier <= tier_empire
				empire = title:e_latin_empire
			}
		}
	}

	ai_will_do = {
		base = 100
		modifier = {
			primary_title = {
				tier <= tier_empire
				empire = title:e_latin_empire
			}
			add = -60
		}
		modifier = {
			NAND = {
				culture = {
					OR = {
						this = culture:greek
						any_parent_culture_or_above = { this = culture:greek }
					}
				}
				OR = {
					ep3_orthodox_faith_trigger = yes
					faith = faith:hellenic_pagan
				}
			}
			add = -30
		}
	}
		} # end of before

		after = {
	ai_potential = {
		# IRToCK3: AI shouldn't bother if e_byzantium or h_roman_empire already have holders
		NOR = {
			exists = title:e_byzantium.holder
			exists = title:h_roman_empire.holder
		}
		# IRToCK3: AI shouldn't bother if they have the WRE since they should focus on h_roman_empire
		NOT = { has_title = title:h_western_roman_empire }
		any_held_title = {
			title_tier = kingdom
			# IRToCK3: Modified so that the de jure empire the kingdom belongs to is only checked if the Latin Empire exists, so that it is only relevant during the Splintered Crusade
			trigger_if = {
				limit = {
					exists = title:e_latin_empire.holder
				}

				OR = {
					empire = title:e_latin_empire
					empire = title:e_byzantium
				}
			}
		}
		OR = {
			culture = {
				OR = {
					# IRToCK3: Greeks/Romans should try to do this decision
					this = culture:greek
					this = culture:roman
					any_parent_culture_or_above = { this = culture:greek }
					any_parent_culture_or_above = { this = culture:roman }
				}
			}
			ep3_orthodox_faith_trigger = yes
			primary_title = {
				tier <= tier_empire
				empire = title:e_latin_empire
			}
		}
	}

	ai_will_do = {
		base = 100
		modifier = {
			primary_title = {
				tier <= tier_empire
				empire = title:e_latin_empire
			}
			add = -60
		}
		modifier = {
			NAND = {
				culture = {
					OR = {
						# IRToCK3: Make it so non-Greeks/Romans are less likely to take decision
						this = culture:greek
						this = culture:roman
						any_parent_culture_or_above = { this = culture:greek }
						any_parent_culture_or_above = { this = culture:roman }
					}
				}
				OR = {
					ep3_orthodox_faith_trigger = yes
					faith = faith:hellenic_pagan
				}
			}
			add = -30
		}
	}
		} # end of after
	} # end of ai blocks

	
	#########
	# retake_eastern_provinces_decision
	#########

	replace = {
		before = {
	is_shown = {
		has_ep3_dlc_trigger = yes
		has_title = title:e_byzantium
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:retake_eastern_provinces_decision
			}
		}
	}
		} # end of before

		after = {
	is_shown = {
		always = no # IRToCK3: Prevents the decision from being available since it doesn't really make sense given the new history of the world. Removing this line here will add it back in as normal
		has_ep3_dlc_trigger = yes
		has_title = title:e_byzantium
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:retake_eastern_provinces_decision
			}
		}
	}
		} # end of after
	}


	#########
	# evangelize_the_slavs_decision
	#########

	# is_shown block
	replace = {
		before = {
		has_ep3_dlc_trigger = yes
		# Byz emperor or governor
		OR = {
			has_title = title:e_byzantium
			liege = { has_title = title:e_byzantium }
		}
		faith.religion = religion:christianity_religion
		# You border with pagans to convert
		trigger_if = {
			limit = {
				has_title = title:e_byzantium
			}
			any_neighboring_and_across_water_top_liege_realm_owner = {
				valid_for_pagan_conversion_trigger = yes
			}
		}
		trigger_else = {
			any_neighboring_and_across_water_realm_same_rank_owner = {
				valid_for_pagan_conversion_trigger = yes
			}
		}
		} # end of before

		after = {
		has_ep3_dlc_trigger = yes
		# Byz emperor or governor
		OR = {
			is_roman_emperor_trigger = yes # IRToCK3: Extend to other Roman Empire titles
			liege = { is_roman_emperor_trigger = yes } # IRToCK3: Extend to other Roman Empire titles
		}
		faith.religion = religion:christianity_religion
		# You border with pagans to convert
		trigger_if = {
			limit = {
				is_roman_emperor_trigger = yes # IRToCK3: Extend to other Roman Empire titles
			}
			any_neighboring_and_across_water_top_liege_realm_owner = {
				valid_for_pagan_conversion_trigger = yes
			}
		}
		trigger_else = {
			any_neighboring_and_across_water_realm_same_rank_owner = {
				valid_for_pagan_conversion_trigger = yes
			}
		}
		} # end of after
	} # end of is_shown block

	# is_valid block
	replace = {
		before = {
		government_has_flag = government_is_administrative
		trigger_if = {
			limit = {
				has_title = title:e_byzantium
			}
			custom_tooltip = {
				any_neighboring_and_across_water_top_liege_realm_owner = {
					valid_for_pagan_conversion_trigger = yes
				}
				text = valid_neighboring_and_across_water_top_liege
			}
		}
		trigger_else = {
			custom_tooltip = {
				any_neighboring_and_across_water_realm_same_rank_owner = {
					valid_for_pagan_conversion_trigger = yes
				}
				text = valid_neighboring_and_across_water_realm_same_rank
			}
		}
		} # end of before

		after = {
		government_has_flag = government_is_administrative
		trigger_if = {
			limit = {
				is_roman_emperor_trigger = yes # IRToCK3: Extend to other Roman Empire titles
			}
			custom_tooltip = {
				any_neighboring_and_across_water_top_liege_realm_owner = {
					valid_for_pagan_conversion_trigger = yes
				}
				text = valid_neighboring_and_across_water_top_liege
			}
		}
		trigger_else = {
			custom_tooltip = {
				any_neighboring_and_across_water_realm_same_rank_owner = {
					valid_for_pagan_conversion_trigger = yes
				}
				text = valid_neighboring_and_across_water_realm_same_rank
			}
		}
		} # end of after
	} # end of is_valid block

	# ai_potential block
	replace = {
		before = {
	ai_potential = {
		piety > massive_piety_value
		has_title = title:e_byzantium
	}
		} # end of before

		after = {
	ai_potential = {
		piety > massive_piety_value
		is_roman_emperor_trigger = yes # IRToCK3: Extend to other Roman Empire titles
	}
		} # end of after
	} # end of ai_potential block


	#########
	# reinstitute_grain_dole_decision
	#########

	# is_valid_showing_failures_only block
	replace = {
		before = {
	is_valid_showing_failures_only = {
		is_at_war = no
		NOT = { exists = involved_activity }
		is_imprisoned = no
		custom_tooltip = {
			NOT = {
				title:c_byzantion = { has_county_modifier = panem_et_circenses_county_modifier }
			}
			text = grain_dole_already_active
		}
	}
		} # end of before

		after = {
	is_valid_showing_failures_only = {
		is_at_war = no
		NOT = { exists = involved_activity }
		is_imprisoned = no
		custom_tooltip = {
			NOT = {
				capital_county = { has_county_modifier = panem_et_circenses_county_modifier } # IRToCK3: The base game still has this set to only check c_byzantion, so it won't work with the new changes to allow other Roman Empire titles
			}
			text = grain_dole_already_active
		}
	}
		} # end of after
	} # end of is_valid_showing_failures_only block


	#########
	# split_roman_empire_decision
	#########

	# is_shown block
	replace = {
		before = {
	is_shown = {
		has_ep3_dlc_trigger = yes
		primary_title = title:h_roman_empire
		NOT = { exists = title:h_eastern_roman_empire.holder }
	}
		} # end of before

		after = {
	is_shown = {
		has_ep3_dlc_trigger = yes
		primary_title = title:h_roman_empire
		NOR = { # IRToCK3: Made it so both ERE and WRE can't have holders for decision to be taken
			exists = title:h_eastern_roman_empire.holder
			exists = title:h_western_roman_empire.holder
		}
	}
		} # end of after
	} # end of is_shown block

	# effect block
	replace = {
		before = {
		if = {
			limit = {
				has_active_diarchy = yes
				has_diarchy_type = co_emperorship
			}
			diarch = { save_scope_as = new_holder }
		}
		if = {
			limit = {
				any_powerful_family = {
					this != root.house
					count >= 1
					exists = house_head
				}
			}
			ordered_powerful_family = {
				limit = { this != root.house }
				order_by = house_power_score
				house_head = { save_scope_as = new_holder }
			}
		}
		else = {
			ordered_powerful_vassal = {
				order_by = max_military_strength
				save_scope_as = new_holder
			}
		}
		custom_tooltip = {
			text = form_eastern_roman_empire_tt
			create_eastern_roman_empire_scripted_effect = yes
		}
		title:h_roman_empire = {
			set_title_name = h_roman_empire_western
		}
		} # end of before


		after = {
		if = {
			limit = {
				has_active_diarchy = yes
				has_diarchy_type = co_emperorship
			}
			diarch = { save_scope_as = new_holder }
		}
		else_if = { # IRToCK3: The base game has this as an if statement, which will cause any "new_holder" assignment made in the above block to get overwritten. This should fix that issue
			# IRToCK3: This just makes sure there is a valid powerful family house head, and if they are landed, they need to be in the relevant ere region, to prevent someone nowhere near the area from becoming the Emperor
			limit = {
				any_powerful_family = {
					count >= 1
					this != root.house
					house_head ?= {
						trigger_if = {
							limit = { is_landed = yes }
							capital_county.title_province = { geographical_region = custom_ep3_restore_rome_eastern_empire }
						}
					}
				}
			}

			ordered_powerful_family = {
				limit = {
					this != root.house
					house_head ?= {
						trigger_if = {
							limit = { is_landed = yes }
							capital_county.title_province = { geographical_region = custom_ep3_restore_rome_eastern_empire }
						}
					}
				}
				order_by = house_power_score
				house_head = { save_scope_as = new_holder }
			}
		}
		else_if = {
			# IRToCK3: This just makes sure there is a valid powerful vassal in the relevant ere region, to prevent someone nowhere near the area from becoming the Emperor, prioritizing those with the same government
			limit = {
				any_powerful_vassal = {
					count >= 1
					capital_county.title_province = { geographical_region = custom_ep3_restore_rome_eastern_empire }
				}
			}

			ordered_powerful_vassal = {
				limit = {
					capital_county.title_province = { geographical_region = custom_ep3_restore_rome_eastern_empire }
					has_same_government = root
				}
				alternative_limit = {
					capital_county.title_province = { geographical_region = custom_ep3_restore_rome_eastern_empire }
				}
				order_by = max_military_strength
				save_scope_as = new_holder
			}
		}
		else_if = {
			# IRToCK3: Added this check on the off chance none of the powerful vassals are in the region, so it checks if ANY vassal is in the region, prioritizing those with the same government
			limit = {
				any_vassal = {
					count >= 1
					capital_county.title_province = { geographical_region = custom_ep3_restore_rome_eastern_empire }
				}
			}

			ordered_vassal = {
				limit = {
					capital_county.title_province = { geographical_region = custom_ep3_restore_rome_eastern_empire }
					has_same_government = root
				}
				alternative_limit = {
					capital_county.title_province = { geographical_region = custom_ep3_restore_rome_eastern_empire }
				}
				order_by = max_military_strength
				save_scope_as = new_holder
			}
		}
		else = {
			# IRToCK3: Finally, if all else fails, give it to a courtier, favoring those with higher skill
			random_courtier = {
				weight = {
					base = sum_of_all_skills_value
					modifier = {
						is_lowborn = no
						add = 5
					}
					modifier = {
						faith = root.faith
						add = 10
					}
					modifier = {
						culture = root.culture
						add = 5
					}
				}
				save_scope_as = new_holder
			}
		}
		custom_tooltip = {
			text = form_eastern_roman_empire_tt
			create_eastern_roman_empire_scripted_effect = yes
		}
		} # end of after
	}

}


"common/scripted_effects/00_major_decisions_scripted_effects_3.txt" = {
	#########
	# recreate_ere_decision_effect
	#########

	# For now, modifying it so that any fully controlled kingdom is de jure drifted to be under e_byzantium
	replace = {
		before = {
	if = {
		limit = {
			title:e_latin_empire = {
				any_in_de_jure_hierarchy = {
					tier < tier_empire
				}
			}
		}
		title:e_latin_empire = {
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_kingdom
				}
				set_de_jure_liege_title = title:e_byzantium
			}
		}
		
	}
		} # end of before

		after = {
	if = {
		limit = {
			title:e_latin_empire = {
				any_in_de_jure_hierarchy = { tier = tier_kingdom }
			}
		}
		# IRToCK3: Since this decision deletes e_latin_empire if you hold it, made it so that if you have the title it transfers ALL kingdoms under it to e_byzantium, but if you don't hold it, you need to control at least half of it.
		if = {
			limit = {
				any_held_title = { this = title:e_latin_empire }
			}
			title:e_latin_empire = {
				every_in_de_jure_hierarchy = {
					limit = { tier = tier_kingdom }
					set_de_jure_liege_title = title:e_byzantium
				}
			}
		}
		else = {
			title:e_latin_empire = {
				every_in_de_jure_hierarchy = {
					limit = {
						tier = tier_kingdom
						any_de_jure_county = { # IRToCK3: Added this condition since it is a little weird how someone holding as little as 12 counties recreating the ERE can somehow magically make every single de jure kingdom under the Latin Empire now become de jure part of the ERE
							percent >= 0.51
							holder.top_liege = root
						}
					}
					set_de_jure_liege_title = title:e_byzantium
				}
			}
		}
	}

	# IRToCK3: For now also adding every completely controlled kingdom to e_byzantium to make sure it gains some de jure land
	every_sub_realm_county = {
		limit = {
			exists = kingdom
			OR = {
				NOT = { exists = kingdom.holder }
				kingdom.holder.top_liege ?= root # IRToCK3: This should be valid if the character themselves holds the kingdom, or they are an emperor and the holder is their vassal
			}
			kingdom = { save_temporary_scope_as = test_kingdom }
			OR = { # IRToCK3: Modified it so that either the character must completely control the kingdom, or control half of it and hold its title
				holder.top_liege = { completely_controls = scope:test_kingdom }
				kingdom = {
					AND = {
						holder.top_liege ?= root
						any_de_jure_county = {
							percent >= 0.51
							holder.top_liege = root
						}
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					kingdom = { is_in_list = additional_de_jure_kingdoms }
				}
			}
			kingdom = {
				set_de_jure_liege_title = title:e_byzantium
				add_to_list = additional_de_jure_kingdoms
			}
		}
	}

	# IRToCK3: Also drift all kingdoms from held empire titles to ERE, then delete title
	every_held_title = {
		title_tier = empire
		limit = {
			NOT = { this = title:e_byzantium }
		}

		every_in_de_jure_hierarchy = {
			limit = { tier = tier_kingdom }
			set_de_jure_liege_title = title:e_byzantium
		}

		save_scope_as = empire_to_delete

		root = { destroy_title = scope:empire_to_delete }
	}
		} # end of after
	}
}


"common/decisions/80_major_decisions_roman.txt" = {
	#########
	# set_capital_rome_decision
	#########

	# is_shown block
	replace = {
		before = {
		has_title = title:h_roman_empire
		NOT = { capital_county = { this = title:c_roma } }
		} # end of before

		after = {
		OR = { # IRToCK3: Also allow the WRE to take this decision
			has_title = title:h_roman_empire
			has_title = title:h_western_roman_empire
		}
		NOT = { capital_county = { this = title:c_roma } }
		} # end of after
	}

	# ai_potential block
	replace = {
		before = {
	ai_potential = {
		has_title = title:h_roman_empire
	}
		} # end of before

		after = {
	ai_potential = {
		OR = { # IRToCK3: Also allow the WRE to take this decision
			has_title = title:h_roman_empire
			has_title = title:h_western_roman_empire
		}
	}
		} # end of after
	}


	#########
	# rebuke_roman_revanchism_sicily
	#########

	replace = {
		before = {
		# Standard filter checks.
		is_playable_character = yes
		# Sicily is still under the ERE.
		title:e_byzantium = { is_de_jure_liege_or_above_target = title:k_sicily }
		} # end of before

		after = {
		always = no # IRToCK3: Makes decision impossible, since it doesn't really make sense given de jure map and history changes
		# Standard filter checks.
		is_playable_character = yes
		# Sicily is still under the ERE.
		title:e_byzantium = { is_de_jure_liege_or_above_target = title:k_sicily }
		} # end of after
	}


	#########
	# dismantle_byz_pretender_decision
	#########

	replace = {
		before = {
		exists = title:e_byzantium.holder #Must exist in the first place...
		NOT = {
			root = title:e_byzantium.holder #That'd be awkward...
		}
		OR = {
			culture = { has_cultural_pillar = heritage_frankish }
			culture = { has_cultural_pillar = heritage_central_germanic }
			culture = { has_cultural_pillar = heritage_latin }
		}
		is_ruler = yes
		is_playable_character = yes
		is_roman_emperor_trigger = yes
		NOR = { #Once an Emperor throws the challenge, he has only one chance to dismantle the Empire.
			has_character_flag = flag_emperor_challenging_byz #Applied below.
			has_character_flag = flag_emperor_challenged_byz #Applied in war.
		}
		} # end of before

		after = {
		exists = title:e_byzantium.holder #Must exist in the first place...
		NOT = {
			root = title:e_byzantium.holder #That'd be awkward...
		}
		OR = { # IRToCK3: Removed heritage_latin since limiting this to HRE
			culture = { has_cultural_pillar = heritage_frankish }
			culture = { has_cultural_pillar = heritage_central_germanic }
		}
		is_ruler = yes
		is_playable_character = yes
		has_title = title:e_hre # IRToCK3: Limiting this decision so only the HRE can take it
		NOR = { #Once an Emperor throws the challenge, he has only one chance to dismantle the Empire.
			has_character_flag = flag_emperor_challenging_byz #Applied below.
			has_character_flag = flag_emperor_challenged_byz #Applied in war.
		}
		} # end of after
	}


	#########
	# restore_roman_empire_holy_decision
	#########

	replace = {
		before = {
		is_ruler = yes
		is_playable_character = yes
		has_title = title:e_hre
		} # end of before

		after = {
		always = no # IRToCK3: Prevents decision from being available, given it doesn't make as much sense with new history, and giving priority to WRE and ERE forming Rome. Remove this line to add the decision back in as it was.
		is_ruler = yes
		is_playable_character = yes
		has_title = title:e_hre
		} # end of after
	}


	#########
	# restore_roman_empire_italian_decision
	#########

	replace = {
		before = {
		is_ruler = yes
		is_playable_character = yes
		has_title = title:e_italy
		} # end of before

		after = {
		always = no # IRToCK3: Prevents decision from being available, given it doesn't make as much sense with new history, and giving priority to WRE and ERE forming Rome. Remove this line to add the decision back in as it was.
		is_ruler = yes
		is_playable_character = yes
		has_title = title:e_italy
		} # end of after
	}


	#########
	# restore_roman_empire_decision
	#########

	# is_shown block
	replace = {
		before = {
		is_ruler = yes
		is_playable_character = yes
		has_title = title:e_byzantium
		NOT = { primary_title = title:e_hre }
		NOT = { primary_title = title:e_italy }
		} # end of before

		after = {
		is_ruler = yes
		is_playable_character = yes
		OR = { # IRToCK3: Making it so only the WRE/ERE can reform rome, so forming one of those first would be the priority
			has_title = title:h_eastern_roman_empire
			has_title = title:h_western_roman_empire
		}
		NOT = { primary_title = title:e_hre }
		NOT = { primary_title = title:e_italy }
		} # end of after
	}

	# is_valid block
	replace = {
		before = {
		prestige_level >= max_prestige_level

		completely_controls = title:d_latium
		completely_controls = title:d_venice
		completely_controls = title:d_romagna
		} # end of before

		after = {
		prestige_level >= max_prestige_level

		# IRToCK3: Doesn't make sense for one half of the split Roman Empire to reform Rome if the other remains independent, so you either need to hold both titles or be the only one holding either the ERE or WRE titles
		custom_tooltip = {
			text = irtock3_only_roman_emperor
			OR = {
				AND = {
					has_title = title:h_eastern_roman_empire
					has_title = title:h_western_roman_empire
				}
				AND = {
					has_title = title:h_eastern_roman_empire
					NOT = { exists = title:h_western_roman_empire.holder }
				}
				AND = {
					has_title = title:h_western_roman_empire
					NOT = { exists = title:h_eastern_roman_empire.holder }
				}
			}
		}

		completely_controls = title:d_latium
		completely_controls = title:d_venice
		completely_controls = title:d_romagna
		} # end of after
	}


	#########
	# form_rum_sultanate_decision
	#########

	replace = {
		before = {
		NOT = { culture = culture:greek }
		NOT = { faith.religion = religion:christianity_religion }
		OR = {
			top_liege = this
			top_liege = { faith.religion = faith:ashari.religion }
		}
		} # end of before

		after = {
		NOT = { culture = culture:greek }
		NOT = { culture = culture:roman } # IRToCK3: Added roman as invalid culture
		NOT = { faith.religion = religion:christianity_religion }
		OR = {
			top_liege = this
			top_liege = { faith.religion = faith:ashari.religion }
		}
		} # end of after
	}


	#########
	# unify_italian_empire_decision
	#########
	# Making this decision impossible to take for now, until relevant modifications can be determined for it to make sense.

	# is_shown block
	replace = {
		before = {
		culture = { has_cultural_pillar = heritage_latin }
		is_ruler = yes
		is_playable_character = yes
		highest_held_title_tier > 2 #Dukes and above
		capital_province = { geographical_region = world_europe_south_italy }
		}

		after = {
		always = no # IRToCK3: Makes this decision impossible for now since it doesn't make sense with the world's history changed
		culture = { has_cultural_pillar = heritage_latin }
		is_ruler = yes
		is_playable_character = yes
		highest_held_title_tier > 2 #Dukes and above
		capital_province = { geographical_region = world_europe_south_italy }
		}
	}


	#########
	# restore_papacy_decision
	#########
	# These changes make the decision's localization change depending on whether the Papal States has existed already or not

	# Decision loc info
	replace = {
		before = {
	desc = restore_papacy_decision_desc
	selection_tooltip = restore_papacy_decision_tooltip
		} # end of before

		after = {
	# IRToCK3: Made it so the localization of this decision changes depending on whether the Papal States has existed already or not
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { exists = title:k_papal_state.previous_holder }
				}
				desc = restore_papacy_decision_title_set
			}
			desc = restore_papacy_decision_title_restore
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { exists = title:k_papal_state.previous_holder }
				}
				desc = restore_papacy_decision_desc_set
			}
			desc = restore_papacy_decision_desc_restore
		}
	}
	selection_tooltip = {
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { exists = title:k_papal_state.previous_holder }
				}
				desc = restore_papacy_decision_tooltip_set
			}
			desc = restore_papacy_decision_tooltip_restore
		}
	}
	confirm_text = {
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { exists = title:k_papal_state.previous_holder }
				}
				desc = restore_papacy_decision_confirm_set
			}
			desc = restore_papacy_decision_confirm_restore
		}
	}
		} # end of after
	}

	# effect block
	replace = {
		before = {
		custom_tooltip = restore_papacy_decision_effect_tooltip
		} # end of before

		after = {
		# IRToCK3: Made it so the custom tooltip chosen depends on whether the Papal States has existed already or not
		switch = {
			trigger = exists
			title:k_papal_state.previous_holder = {
				custom_tooltip = restore_papacy_decision_effect_tooltip_restore
			}
			fallback = {
				custom_tooltip = restore_papacy_decision_effect_tooltip_set
			}
		}
		} # end of after
	} # End of effect block


	#########
	# dismantle_papacy_decision
	#########

	# is_shown block
	replace = {
		before = {
		faith:catholic = {
			has_doctrine = doctrine_spiritual_head
		}
		} # end of before

		after = {
		# IRToCK3: Base game checks if Catholicism has doctrine_spiritual_head, but changing this to just check if a Pope exists so there won't be any issues with a Pope not existing at game start
		faith:catholic = {
			exists = religious_head
		}
		} # end of after
	} # End of is_shown block

	# is_valid block
	replace = {
		before = {
			title:k_papal_state.holder = { is_playable_character = no } #If he fled elsewhere, it cannot be done, the Pope must be landless.
		} # end of before

		after = {
			# IRToCK3: Base game checks if they are playable, when they just want to check that they are unlanded, which can be a little confusing when reading the requirements
			title:k_papal_state.holder = {
				is_landed = no #If he fled elsewhere, it cannot be done, the Pope must be landless.
				# IRToCK3: Making it so that you must have the Pope as a prisoner to prevent the decision from being possible right after game start, until a better alternative is decided
				is_imprisoned_by = root
			} 
		} # end of after
	} # End of is_valid block


	#########
	# set_capital_constantinople_decision
	#########

	# is_shown block
	replace = {
		before = {
		has_title = title:e_byzantium
		NOT = { capital_county = { this = title:c_byzantion } }
		}

		after = {
		OR = {
			has_title = title:e_byzantium
			has_title = title:h_eastern_roman_empire # IRToCK3: Added ERE as possible title
		}
		NOT = { capital_county = { this = title:c_byzantion } }
		}
	}
}


"common/decisions/dlc_decisions/ep_3/06_ep3_admin_decisions.txt" = {
	#########
	# convert_to_administrative_decision
	#########

	# ai_will_do block
	replace = {
		before = {
			culture = {
				any_parent_culture_or_above = {
					OR = {
						this = culture:han
						this = culture:greek
					}
				}
			}
			add = 100
		} # end of before

		after = {
			culture = {
				any_parent_culture_or_above = {
					OR = {
						this = culture:han
						this = culture:greek
						this = culture:roman # IRToCK3: Added roman as possible ancestor culture
					}
				}
			}
			add = 100
		} # end of after
	}

}


"common/scripted_effects/00_major_decisions_scripted_effects.txt" = {
	#########
	# create_eastern_roman_empire_scripted_effect
	#########

	# Change Roman Empire title and de jure hierarchy to the WRE title to represent full Empire split
	replace = {
		before = {
	resolve_title_and_vassal_change = scope:change
	
	every_empire = {
		limit = {
			OR = {
				any_de_jure_county = {
					percent >= 0.75
					holder = {
						OR = {
							this = scope:new_holder
							any_liege_or_above = { this = scope:new_holder }
						}
					}
				}
				AND = {
					de_jure_liege = title:h_eastern_roman_empire
					any_de_jure_county = {
						percent >= 0.51
						holder = {
							OR = {
								this = scope:new_holder
								any_liege_or_above = { this = scope:new_holder }
							}
						}
					}
				}
			}
		}
		set_de_jure_liege_title = title:h_eastern_roman_empire
	}
		} # end of before

		after = {
	every_empire = {
		limit = {
			OR = {
				any_de_jure_county = {
					percent >= 0.75
					holder = {
						OR = {
							this = scope:new_holder
							any_liege_or_above = { this = scope:new_holder }
						}
					}
				}
				AND = {
					de_jure_liege = title:h_eastern_roman_empire
					any_de_jure_county = {
						percent >= 0.51
						holder = {
							OR = {
								this = scope:new_holder
								any_liege_or_above = { this = scope:new_holder }
							}
						}
					}
				}
			}
		}
		set_de_jure_liege_title = title:h_eastern_roman_empire
	}

	# IRToCK3: Set remaining empires to be under WRE, and swap h_roman_empire title with WRE title
	title:h_roman_empire = {
		every_in_de_jure_hierarchy = {
			limit = { tier = tier_empire }
			set_de_jure_liege_title = title:h_western_roman_empire
		}
	}

	title:h_western_roman_empire = {
		change_title_holder = {
			holder = title:h_roman_empire.holder
			change = scope:change
		}
	}

	root = { set_primary_title_to = title:h_western_roman_empire }

	resolve_title_and_vassal_change = scope:change

	root = { destroy_title = title:h_roman_empire }
		} # end of after
	}


	#########
	# split_byzantine_empire_effect
	#########
	# This effect splits up e_byzantium into several regional empires that better match the Roman administrative divisions, but they need to be changed to account for the fact that converted save games won't look the same as the base game

	# Setting up e_italia
	replace = {
		before = {
					limit = {
						title:e_italy ?= { is_titular = no }
						tier = tier_kingdom
						OR = {
							title:k_trinacria ?= this
							title:k_sicily ?= this
							title:k_naples ?= this
							title:k_venice ?= this
						}
					}
		}

		after = {
					limit = {
						title:e_italy ?= { is_titular = no }
						tier = tier_kingdom
						OR = {
							title:k_trinacria ?= this
							title:k_sicily ?= this
							title:k_naples ?= this
							title:k_venice ?= this
							# IRToCK3: Added this so that any kingdom where more than half of it is in the region also gets drifted
							any_de_jure_county = {
								percent >= 0.51
								title_province = { geographical_region = world_europe_south_italy }
							}
						}
					}
		}
	}

	# Setting up e_illyria
	replace = {
		before = {
					limit = {
						tier = tier_kingdom	
						OR = {
							title:k_trinacria ?= this
							title:k_epirus ?= this
							title:k_croatia ?= this
							title:k_serbia ?= this
							title:k_bosnia ?= this
							title:k_sicily ?= this
							title:k_venice ?= this
							title:k_naples ?= this
						}
					}
		}

		after = {
					limit = {
						tier = tier_kingdom	
						OR = {
							title:k_trinacria ?= this
							title:k_croatia ?= this
							title:k_serbia ?= this
							title:k_bosnia ?= this
							title:k_sicily ?= this
							title:k_venice ?= this
							title:k_naples ?= this
							# IRToCK3: Added this so that any kingdom where more than half of it is in the region also gets drifted
							any_de_jure_county = {
								percent >= 0.51
								title_province = { geographical_region = custom_roman_illyricum }
							}
						}
					}
		}
	}

	# Setting up e_macedonia
	replace = {
		before = {
					limit = {
						tier = tier_kingdom	
						OR = {
							title:k_thessalonika ?= this
							title:k_hellas ?= this
							title:k_krete ?= this
							title:k_bulgaria ?= this
						}
					}
		}

		after = {
					limit = {
						tier = tier_kingdom	
						OR = {
							title:k_thessalonika ?= this
							title:k_hellas ?= this
							title:k_krete ?= this
							title:k_bulgaria ?= this
							title:k_epirus ?= this
							# IRToCK3: Added this so that any kingdom where more than half of it is in the region also gets drifted
							any_de_jure_county = {
								percent >= 0.51
								title_province = { geographical_region = converter_custom_macedonia_region }
							}
						}
					}
		}
	}

	# Setting up e_anatolia
	replace = {
		before = {
					limit = {
						tier = tier_kingdom
						OR = {
							title:k_saruhan ?= this
							title:k_tekke ?= this
							title:k_trebizond ?= this
							title:k_ottoman ?= this
							title:k_rum ?= this
							title:k_mentese ?= this
							title:k_karaman ?= this
							title:k_germiyan ?= this
							title:k_cyprus ?= this
							title:k_eretnid ?= this
							title:k_candar ?= this
							title:k_nikaea ?= this
							title:k_pontus ?= this
							title:k_armenia ?= this
							title:k_georgia ?= this
							title:k_armenian_principality ?= this
							title:k_old_armenia ?= this
							title:k_anatolia ?= this
							title:k_aydin ?= this
						}
					}
		}

		after = {
					limit = {
						tier = tier_kingdom
						OR = {
							title:k_saruhan ?= this
							title:k_tekke ?= this
							title:k_trebizond ?= this
							title:k_ottoman ?= this
							title:k_rum ?= this
							title:k_mentese ?= this
							title:k_karaman ?= this
							title:k_germiyan ?= this
							title:k_cyprus ?= this
							title:k_eretnid ?= this
							title:k_candar ?= this
							title:k_nikaea ?= this
							title:k_pontus ?= this
							title:k_armenia ?= this
							title:k_georgia ?= this
							title:k_armenian_principality ?= this
							title:k_old_armenia ?= this
							title:k_anatolia ?= this
							title:k_aydin ?= this
							# IRToCK3: Added this so that any kingdom where more than half of it is in the region also gets drifted
							any_de_jure_county = {
								percent >= 0.51
								title_province = { geographical_region = converter_custom_anatolia_region }
							}
						}
					}
		}
	}
}


"common/character_interactions/00_character_interactions.txt" = {
	
	# offer_vassalization_interaction ai_accept block
	replace = {
		before = {
					OR = {
						this = culture:greek
						any_parent_culture_or_above = {
							this = culture:greek
						}
						this = culture:han
						any_parent_culture_or_above = {
							this = culture:han
						}
					}
		}# end of before

		after = {
					OR = { # IRToCK3: Modified to include roman since this is historical admin realm cultures
						this = culture:greek
						this = culture:roman
						any_parent_culture_or_above = {
							this = culture:greek
						}
						any_parent_culture_or_above = {
							this = culture:roman
						}
						this = culture:han
						any_parent_culture_or_above = {
							this = culture:han
						}
					}
		} # end of after
	}

}


"common/culture/traditions/07_ep3_traditions.txt" = {
	
	# tradition_ep3_imperial_tagmata is_shown block
	replace = {
		before = {
		OR = {
			this = culture:greek
			any_parent_culture_or_above = {
				this = culture:greek
			}
			has_cultural_pillar = heritage_byzantine
		}
		# DLC check.
		has_ep3_dlc_trigger = yes
		NOT = {
			has_cultural_tradition = tradition_roman_legacy
		}
		}# end of before

		after = {
		OR = { # IRToCK3: Added roman as possible culture
			this = culture:greek
			this = culture:roman
			any_parent_culture_or_above = {
				this = culture:greek
			}
			any_parent_culture_or_above = {
				this = culture:roman
			}
			#has_cultural_pillar = heritage_byzantine # IRToCK3: Removed since this heritage now represents general Hellenistic cultures, so it doesn't really fit
		}
		# DLC check.
		has_ep3_dlc_trigger = yes
		NOT = {
			has_cultural_tradition = tradition_roman_legacy
		}
		} # end of after
	}
	
	# tradition_ep3_roman_ceremonies & tradition_ep3_palace_politics is_shown block
	replace = {
		before = {
		OR = {
			this = culture:greek
			any_parent_culture_or_above = {
				this = culture:greek
			}
			has_cultural_pillar = heritage_byzantine
			scope:character = {
				is_roman_emperor_trigger = yes
			}
		}
		# DLC check.
		has_ep3_dlc_trigger = yes
		NOT = {
			has_cultural_tradition = tradition_byzantine_succession
		}
		}# end of before

		after = {
		OR = { # IRToCK3: Added roman as possible culture
			this = culture:greek
			this = culture:roman
			any_parent_culture_or_above = {
				this = culture:greek
			}
			any_parent_culture_or_above = {
				this = culture:roman
			}
			#has_cultural_pillar = heritage_byzantine # IRToCK3: Removed since this heritage now represents general Hellenistic cultures, so it doesn't really fit
			scope:character = {
				OR = {
					is_roman_emperor_trigger = yes
					# IRToCK3: Also made it so that if you are in one of the Roman empire titles, you can choose this, as if being influenced by their traditions
					top_liege = { is_roman_emperor_trigger = yes }
				}
			}
		}
		# DLC check.
		has_ep3_dlc_trigger = yes
		NOT = {
			has_cultural_tradition = tradition_byzantine_succession
		}
		} # end of after
	}

	# tradition_ep3_cultivated_sophistication ai_will_do block
	replace = {
		before = {
			limit = { # Admin should be more into this
				OR = {
					this = culture:greek
					any_parent_culture_or_above = {
						this = culture:greek
					}
					has_cultural_pillar = heritage_byzantine
				}
			}
			multiply = 2
		}# end of before

		after = {
			limit = { # Admin should be more into this
				OR = { # IRToCK3: Added roman as possible culture
					this = culture:greek
					this = culture:roman
					any_parent_culture_or_above = {
						this = culture:greek
					}
					any_parent_culture_or_above = {
						this = culture:roman
					}
					#has_cultural_pillar = heritage_byzantine # IRToCK3: Removed since this heritage now represents general Hellenistic cultures
				}
			}
			multiply = 2
		} # end of after
	}

}


"common/scripted_modifiers/07_ep3_scripted_modifiers.txt" = {
	
	# demand_admin_acceptance_modifier
	replace = {
		before = {
		scope:recipient = {
			culture = {
				OR = {
					this = culture:greek
					any_parent_culture_or_above = {
						this = culture:greek
					}
					this = culture:han
					any_parent_culture_or_above = {
						this = culture:han
					}
				}
			}
		}
		desc = "HISTORICAL_ADMIN_REASON"
		}# end of before

		after = {
		scope:recipient = {
			culture = {
				OR = { # IRToCK3: Added roman as more likely culture
					this = culture:greek
					any_parent_culture_or_above = {
						this = culture:greek
					}
					this = culture:roman
					any_parent_culture_or_above = {
						this = culture:roman
					}
					this = culture:han
					any_parent_culture_or_above = {
						this = culture:han
					}
				}
			}
		}
		desc = "HISTORICAL_ADMIN_REASON"
		} # end of after
	}
	
}


"events/decisions_events/roman_restoration_events.txt" = {

	#########
	# roman_restoration.0124
	#########

	# Event description block
	replace = {
		before = {
	desc = roman_restoration.0124.desc
		} # end of before

		after = {
	# IRToCK3: This makes it so the description of the event changes depending on whether the Papal States have existed already or not
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { exists = title:k_papal_state.previous_holder }
				}
				desc = roman_restoration.0124.desc_set
			}
			desc = roman_restoration.0124.desc_restore
		}
	}
		} # end of after
	} # End of event description block

	# Option A block
	replace = {
		before = {
		name = roman_restoration.0124.a
		} # end of before

		after = {
		# IRToCK3: This makes it so the name of this option changes depending on whether the Papal States have existed already or not
		name = {
			trigger = {
				NOT = { exists = title:k_papal_state.previous_holder }
			}
			text = roman_restoration.0124.a_set
		}
		name = {
			trigger = {
				exists = title:k_papal_state.previous_holder
			}
			text = roman_restoration.0124.a_restore
		}
		} # end of after
	} # End of Option A block


	#########
	# roman_restoration.0125
	#########

	# Event description block
	replace = {
		before = {
	desc = {
		first_valid = {
			# Catholic Reaction
			triggered_desc = {
				trigger = {
					root.faith = faith:catholic
				}
				desc = roman_restoration.0125.desc.catholic
			}
			# Every other Christian
			triggered_desc = {
				trigger = {
					NOT = {
						root.faith = faith:catholic
					}

				}
				desc = roman_restoration.0125.desc.other
			}
		}
	}
		} # end of before

		after = {
	# IRToCK3: This changes the description of the event based off whether the character is Catholic/not Catholic, and whether the Papacy has existed already or not
	desc = {
		first_valid = {
			# Catholic Reaction
			triggered_desc = {
				trigger = {
					root.faith = faith:catholic
					NOT = { exists = title:k_papal_state.previous_holder }
				}
				desc = roman_restoration.0125.desc.catholic_set
			}
			triggered_desc = {
				trigger = {
					root.faith = faith:catholic
					exists = title:k_papal_state.previous_holder
				}
				desc = roman_restoration.0125.desc.catholic_restore
			}
			# Every other Christian
			triggered_desc = {
				trigger = {
					NOT = {
						root.faith = faith:catholic
					}
					NOT = { exists = title:k_papal_state.previous_holder }
				}
				desc = roman_restoration.0125.desc.other_set
			}
			triggered_desc = {
				trigger = {
					NOT = {
						root.faith = faith:catholic
					}
					exists = title:k_papal_state.previous_holder
				}
				desc = roman_restoration.0125.desc.other_restore
			}
		}
	}
		} # end of after
	} # End of Event description block

	# Option A block
	replace = {
		before = {
		name = roman_restoration.0125.a
		} # end of before

		after = {
		# IRToCK3: This makes it so the name of this option changes depending on whether the Papal States have existed already or not
		name = {
			trigger = {
				NOT = { exists = title:k_papal_state.previous_holder }
			}
			text = roman_restoration.0125.a_set
		}
		name = {
			trigger = {
				exists = title:k_papal_state.previous_holder
			}
			text = roman_restoration.0125.a_restore
		}
		} # end of after
	} # End of Option A block

}


"common/decisions/80_major_decisions_south_asia.txt" = {
	##################
	## become_chakravarti_decision
	##################
	# is_shown block
	replace = {
		before = {
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:become_chakravarti_decision
			}
		}
		} # end of before

		after = {
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:become_chakravarti_decision
			}
		}
		# IRToCK3: Added this so that the decision will require that e_india has no holder or de jure land, so it can only be taken when it makes sense.
		title:e_india = {
			AND = {
				NOT = { exists = holder }
				any_de_jure_county = {
					count < 1
				}
			}
		}
		} # end of after
	}

	# is_valid block
	replace = {
		before = {
		completely_controls = title:e_rajastan
		completely_controls = title:e_deccan
		completely_controls = title:e_bengal
		} # end of before

		after = {
		completely_controls_region = world_india # IRToCK3: Normally this decision requires you to completely control the empires of Rajastan, Deccan, and Bengal, but since they will likely not exist in a converted save game, this is being changed to just require controlling all of the india region
		} # end of after
	}

	##################
	## found_the_empire_of_hindustan_decision
	##################
	# is_valid block
	replace = {
		before = {
		trigger_if = {
			limit = {
				is_ai = yes
			}
			OR = {
				completely_controls = title:k_punjab
				has_title = title:k_punjab
			}
			OR = {
				completely_controls = title:k_delhi
				has_title = title:k_delhi
			}
		}
		trigger_if = {
			limit = {
				is_ai = no
			} #And have some additional royal dignity for good measure.
			has_title = title:k_punjab
			has_title = title:k_delhi
			completely_controls = title:d_kuru
			OR = {
				has_title = title:k_kosala
				has_title = title:k_malwa
				has_title = title:k_rajputana
			}
		}
		}

		after = {
		trigger_if = {
			limit = {
				is_ai = yes
			}
			# IRToCK3: Base game requires AI to completely control or have the title for the kingdoms of Punjab and Delhi. These titles might not exist in a converted save, so it was made so they either control the area covered by Punjab and Delhi OR control at least half that region and have at least one kingdom title located in the Rajastan area.
			OR = {
				completely_controls_region = converter_custom_hindustan_region
				AND = {
					any_held_title = {
						title_tier = kingdom
						any_de_jure_county = {
							percent >= 0.8 # IRToCK3: To account for weird converted de jure hierarchies
							title_province = { geographical_region = world_india_rajastan }
						}
					}
					any_county_in_region = {
						region = converter_custom_hindustan_region
						percent >= 0.5
						holder.top_liege ?= root
					}
				}
			}
		}
		trigger_if = {
			limit = {
				is_ai = no
			} #And have some additional royal dignity for good measure.
			# IRToCK3: To account for the kingdom titles possibly not appearing in a converted save, this was changed to players need to at least completely control the areas covered by Punjab and Delhi and either: three kingdoms in the Rajastan area; OR 90% of the Rajastan area (to account for weird converted de jure hierarchies)
			completely_controls_region = converter_custom_hindustan_region
			OR = {
				any_held_title = {
					title_tier = kingdom
					count >= 3
					custom_tooltip = {
						text = hindustan_control_3_kingdoms
						any_de_jure_county = {
							percent >= 0.8 # IRToCK3: To account for weird converted de jure hierarchies
							title_province = { geographical_region = world_india_rajastan }
						}
					}
				}
				custom_tooltip = {
					text = hindustan_control_rajastan
					any_county_in_region = {
						region = world_india_rajastan
						percent >= 0.8
						holder.top_liege ?= root
					}
				}
			}
		}
		}
	}

} # End of 80_major_decisions_south_asia.txt


"common/scripted_effects/00_decisions_effects.txt" = {
	##################
	## unite_india_decision_effect
	##################
	replace = {
		before = {
	title:e_rajastan = { set_de_jure_liege_title = title:h_india }
	title:e_deccan = { set_de_jure_liege_title = title:h_india }
	title:e_bengal = { set_de_jure_liege_title = title:h_india }
		} # end of before

		after = {
	# IRToCK3: This effect normally makes the Empires of Rajastan, Deccan, and Bengal de jure under h_india. This is being changed to instead take all empires that are 80% in the india region.
	every_county_in_region = {
		region = world_india
		limit = {
			NOT = {
				empire ?= { is_in_list = indian_empire }
			}
		}

		if = {
			limit = {
				empire = {
					any_de_jure_county = {
						percent >= 0.8
						title_province = { geographical_region = world_india }
					}
				}
			}

			empire = { add_to_list = indian_empire }
		}
	}

	every_in_list = {
		list = indian_empire
		set_de_jure_liege_title = title:h_india
	}
		} # end of after
	}

	replace = {
		before = {
	hidden_effect = {
		if = {
			limit = { has_title = title:e_rajastan }
			destroy_title = title:e_rajastan
		}
		if = {
			limit = { has_title = title:e_deccan }
			destroy_title = title:e_deccan
		}
		if = {
			limit = { has_title = title:e_bengal }
			destroy_title = title:e_bengal
		}
	}
		} # end of before

		after = {
	hidden_effect = {
		# IRToCK3: The effect normally destroys Rajastan, Deccan, and/or Bengal if you have them while taking this decision. This was instead changed to destroy any title you hold that had its kingdoms drifted to be under e_india
		every_held_title = {
			limit = { is_in_list = indian_empire }
			save_scope_as = destroy_empire_title
			root = { destroy_title = scope:destroy_empire_title }
		}
	}
		} # end of after
	}
} # End of 00_decisions_effects.txt


"common/scripted_effects/00_mongol_invasion_effects.txt" = {
	# spawn_temujin_character_effect; Character 125501 (Temujin) won't exist, and converter removed part of this effect, but the part that remains needs to be modified to start with an "if" instead of "else_if" in order to work properly.
	replace = {
		before = {
	else_if = {
		limit = {
			#Generate Temujin if there has BEEN NO Temujin
			NOT = {
				has_global_variable = temujin_was_born
			}
		}
		if = {
			limit = { has_game_rule = inversed_gender_equality }
			create_character = {
				name = "Borte" # AKA: Genghis Khan's wife
				gender = female
				location = scope:temujins_birthplace
				template = borte_character_template
				save_scope_as = temujin
			}
			scope:temujin = {
				# Make temporarily immune to disease
				add_character_flag = {
					flag = immune_to_disease
					years = 15
				}

				add_trait = greatest_of_khans
				give_temujin_land_effect = yes
				add_gold = 5000
				add_dread = high_dread
				spawn_temujins_court_effect = yes
				form_the_mongol_empire_effect = yes
				add_prestige = 25000
				give_nickname = nick_genghis_khan
				if = {
					limit = {
						has_mpo_dlc_trigger = no
						NOT = { has_perk = peacemaker_perk }
					}
					add_perk = peacemaker_perk
				}
				dynasty = {
					add_dynasty_prestige_level = 5
					add_dynasty_prestige = 10000
					add_dynasty_perk = warfare_legacy_1
					add_dynasty_perk = warfare_legacy_2
					add_dynasty_perk = warfare_legacy_3
					add_dynasty_perk = warfare_legacy_4
					add_dynasty_perk = warfare_legacy_5
					if = {
						limit = {
							has_dlc_feature = hybridize_culture
						}
						add_dynasty_perk = ep1_culture_legacy_1
					}
				}
			}
		}
		else_if = {
			limit = { has_game_rule = full_gender_equality }
			random_list = {
				#Female Ghengis Khan.
				50 = {
					create_character = {
						name = "Borte" # AKA: Genghis Khan's wife
						gender = female
						location = scope:temujins_birthplace
						template = borte_character_template
						save_scope_as = temujin
					}
					scope:temujin = {
						# Make temporarily immune to disease
						add_character_flag = {
							flag = immune_to_disease
							years = 15
						}

						add_trait = greatest_of_khans
						give_temujin_land_effect = yes
						add_gold = 5000
						add_dread = high_dread
						spawn_temujins_court_effect = yes
						form_the_mongol_empire_effect = yes
						add_prestige = 25000
						give_nickname = nick_genghis_khan
						if = {
							limit = {
								has_mpo_dlc_trigger = no
								NOT = { has_perk = peacemaker_perk }
							}
							add_perk = peacemaker_perk
						}
						dynasty = {
							add_dynasty_prestige_level = 5
							add_dynasty_prestige = 10000
							add_dynasty_perk = warfare_legacy_1
							add_dynasty_perk = warfare_legacy_2
							add_dynasty_perk = warfare_legacy_3
							add_dynasty_perk = warfare_legacy_4
							add_dynasty_perk = warfare_legacy_5
							if = {
								limit = {
									has_dlc_feature = hybridize_culture
								}
								add_dynasty_perk = ep1_culture_legacy_1
							}
						}
					}
				}
				#Male Ghengis Khan.
				50 = {
					create_character = {
						name = "Temujin" # AKA: Genghis Khan
						location = scope:temujins_birthplace
						template = genghis_khan_character_template
						save_scope_as = temujin
					}
					scope:temujin = {
						# Make temporarily immune to disease
						add_character_flag = {
							flag = immune_to_disease
							years = 15
						}

						add_trait = greatest_of_khans
						give_temujin_land_effect = yes
						add_gold = 5000
						add_dread = high_dread
						spawn_temujins_court_effect = yes
						form_the_mongol_empire_effect = yes
						add_prestige = 25000
						give_nickname = nick_genghis_khan
						if = {
							limit = {
								has_mpo_dlc_trigger = no
								NOT = { has_perk = peacemaker_perk }
							}
							add_perk = peacemaker_perk
						}
						dynasty = {
							add_dynasty_prestige_level = 5
							add_dynasty_prestige = 10000
							add_dynasty_perk = warfare_legacy_1
							add_dynasty_perk = warfare_legacy_2
							add_dynasty_perk = warfare_legacy_3
							add_dynasty_perk = warfare_legacy_4
							add_dynasty_perk = warfare_legacy_5
							if = {
								limit = {
									has_dlc_feature = hybridize_culture
								}
								add_dynasty_perk = ep1_culture_legacy_1
							}
						}
					}
				}
			}
		}
		else = {
			create_character = {
				name = "Temujin" # AKA: Genghis Khan
				location = scope:temujins_birthplace
				template = genghis_khan_character_template
				save_scope_as = temujin
			}
			scope:temujin = {
				# Make temporarily immune to disease
				add_character_flag = {
					flag = immune_to_disease
					years = 15
				}

				add_trait = greatest_of_khans
				give_temujin_land_effect = yes
				add_gold = 5000
				add_dread = high_dread
				spawn_temujins_court_effect = yes
				form_the_mongol_empire_effect = yes
				add_prestige = 25000
				give_nickname = nick_genghis_khan
				if = {
					limit = {
						has_mpo_dlc_trigger = no
						NOT = { has_perk = peacemaker_perk }
					}
					add_perk = peacemaker_perk
				}
				dynasty = {
					add_dynasty_prestige_level = 5
					add_dynasty_prestige = 10000
					add_dynasty_perk = warfare_legacy_1
					add_dynasty_perk = warfare_legacy_2
					add_dynasty_perk = warfare_legacy_3
					add_dynasty_perk = warfare_legacy_4
					add_dynasty_perk = warfare_legacy_5
					if = {
						limit = {
							has_dlc_feature = hybridize_culture
						}
						add_dynasty_perk = ep1_culture_legacy_1
					}
				}
			}
		}
		set_global_variable = {
			name =  temujin_was_born
			value = scope:temujin
		}
	}
		} # End of before

		after = {
	if = {
		limit = {
			#Generate Temujin if there has BEEN NO Temujin
			NOT = {
				has_global_variable = temujin_was_born
			}
		}
		if = {
			limit = { has_game_rule = inversed_gender_equality }
			create_character = {
				name = "Borte" # AKA: Genghis Khan's wife
				gender = female
				location = scope:temujins_birthplace
				template = borte_character_template
				save_scope_as = temujin
			}
			scope:temujin = {
				# Make temporarily immune to disease
				add_character_flag = {
					flag = immune_to_disease
					years = 15
				}

				add_trait = greatest_of_khans
				give_temujin_land_effect = yes
				add_gold = 5000
				add_dread = high_dread
				spawn_temujins_court_effect = yes
				form_the_mongol_empire_effect = yes
				add_prestige = 25000
				give_nickname = nick_genghis_khan
				if = {
					limit = {
						has_mpo_dlc_trigger = no
						NOT = { has_perk = peacemaker_perk }
					}
					add_perk = peacemaker_perk
				}
				dynasty = {
					add_dynasty_prestige_level = 5
					add_dynasty_prestige = 10000
					add_dynasty_perk = warfare_legacy_1
					add_dynasty_perk = warfare_legacy_2
					add_dynasty_perk = warfare_legacy_3
					add_dynasty_perk = warfare_legacy_4
					add_dynasty_perk = warfare_legacy_5
					if = {
						limit = {
							has_dlc_feature = hybridize_culture
						}
						add_dynasty_perk = ep1_culture_legacy_1
					}
				}
			}
		}
		else_if = {
			limit = { has_game_rule = full_gender_equality }
			random_list = {
				#Female Ghengis Khan.
				50 = {
					create_character = {
						name = "Borte" # AKA: Genghis Khan's wife
						gender = female
						location = scope:temujins_birthplace
						template = borte_character_template
						save_scope_as = temujin
					}
					scope:temujin = {
						# Make temporarily immune to disease
						add_character_flag = {
							flag = immune_to_disease
							years = 15
						}

						add_trait = greatest_of_khans
						give_temujin_land_effect = yes
						add_gold = 5000
						add_dread = high_dread
						spawn_temujins_court_effect = yes
						form_the_mongol_empire_effect = yes
						add_prestige = 25000
						give_nickname = nick_genghis_khan
						if = {
							limit = {
								has_mpo_dlc_trigger = no
								NOT = { has_perk = peacemaker_perk }
							}
							add_perk = peacemaker_perk
						}
						dynasty = {
							add_dynasty_prestige_level = 5
							add_dynasty_prestige = 10000
							add_dynasty_perk = warfare_legacy_1
							add_dynasty_perk = warfare_legacy_2
							add_dynasty_perk = warfare_legacy_3
							add_dynasty_perk = warfare_legacy_4
							add_dynasty_perk = warfare_legacy_5
							if = {
								limit = {
									has_dlc_feature = hybridize_culture
								}
								add_dynasty_perk = ep1_culture_legacy_1
							}
						}
					}
				}
				#Male Ghengis Khan.
				50 = {
					create_character = {
						name = "Temujin" # AKA: Genghis Khan
						location = scope:temujins_birthplace
						template = genghis_khan_character_template
						save_scope_as = temujin
					}
					scope:temujin = {
						# Make temporarily immune to disease
						add_character_flag = {
							flag = immune_to_disease
							years = 15
						}

						add_trait = greatest_of_khans
						give_temujin_land_effect = yes
						add_gold = 5000
						add_dread = high_dread
						spawn_temujins_court_effect = yes
						form_the_mongol_empire_effect = yes
						add_prestige = 25000
						give_nickname = nick_genghis_khan
						if = {
							limit = {
								has_mpo_dlc_trigger = no
								NOT = { has_perk = peacemaker_perk }
							}
							add_perk = peacemaker_perk
						}
						dynasty = {
							add_dynasty_prestige_level = 5
							add_dynasty_prestige = 10000
							add_dynasty_perk = warfare_legacy_1
							add_dynasty_perk = warfare_legacy_2
							add_dynasty_perk = warfare_legacy_3
							add_dynasty_perk = warfare_legacy_4
							add_dynasty_perk = warfare_legacy_5
							if = {
								limit = {
									has_dlc_feature = hybridize_culture
								}
								add_dynasty_perk = ep1_culture_legacy_1
							}
						}
					}
				}
			}
		}
		else = {
			create_character = {
				name = "Temujin" # AKA: Genghis Khan
				location = scope:temujins_birthplace
				template = genghis_khan_character_template
				save_scope_as = temujin
			}
			scope:temujin = {
				# Make temporarily immune to disease
				add_character_flag = {
					flag = immune_to_disease
					years = 15
				}

				add_trait = greatest_of_khans
				give_temujin_land_effect = yes
				add_gold = 5000
				add_dread = high_dread
				spawn_temujins_court_effect = yes
				form_the_mongol_empire_effect = yes
				add_prestige = 25000
				give_nickname = nick_genghis_khan
				if = {
					limit = {
						has_mpo_dlc_trigger = no
						NOT = { has_perk = peacemaker_perk }
					}
					add_perk = peacemaker_perk
				}
				dynasty = {
					add_dynasty_prestige_level = 5
					add_dynasty_prestige = 10000
					add_dynasty_perk = warfare_legacy_1
					add_dynasty_perk = warfare_legacy_2
					add_dynasty_perk = warfare_legacy_3
					add_dynasty_perk = warfare_legacy_4
					add_dynasty_perk = warfare_legacy_5
					if = {
						limit = {
							has_dlc_feature = hybridize_culture
						}
						add_dynasty_perk = ep1_culture_legacy_1
					}
				}
			}
		}
		set_global_variable = {
			name =  temujin_was_born
			value = scope:temujin
		}
	}
		} # End of after
	}
} # End of "common/scripted_effects/00_mongol_invasion_effects.txt"
