# Make sure you don't use "irtock3_on_game_start_after_lobby" as an on_action name to prevent it overwriting another on_action setup internally be the converter
on_game_start = {
	on_actions = {
		IRToCK3_game_start_onaction_effects
	}
}

on_game_start_after_lobby = {
	on_actions = {
		IRToCK3_game_start_after_lobby_onaction_effects
	}
}

IRToCK3_game_start_onaction_effects = {
	effect = {
		## Sets a global variable that could be checked by other mods that want to consider whether the IMP-CK3 converter was used
		set_global_variable = irtock3_enabled

		## Fixes weird naming of the Roman Empire
		title:e_roman_empire = { set_definitive_form = yes }
		title:h_roman_empire = { set_definitive_form = yes }

		###################
		## Remove Buddhism/Hinduism/Jainism from Indonesia, if relevant
		###################
		# Check if Buddhism should be removed
		if = {
			limit = {
				any_county_in_region = {
					region = converter_AUH_out_of_scope_region_faith_check
					count < 4 # Need to see if this should be changed, but want a decent chance of it happening
					faith.religion = religion:buddhism_religion
				}
			}
			religion:buddhism_religion = { add_to_list = religions_to_remove }
		}

		# Check if Hinduism should be removed
		if = {
			limit = {
				any_county_in_region = {
					region = converter_AUH_out_of_scope_region_faith_check
					count < 4 # Need to see if this should be changed, but want a decent chance of it happening
					faith.religion = religion:hinduism_religion
				}
			}
			religion:hinduism_religion = { add_to_list = religions_to_remove }
		}

		# Check if Jainism should be removed
		if = {
			limit = {
				any_county_in_region = {
					region = converter_AUH_out_of_scope_region_faith_check
					count < 4 # Need to see if this should be changed, but want a decent chance of it happening
					faith.religion = religion:jainism_religion
				}
			}
			religion:jainism_religion = { add_to_list = religions_to_remove }
		}
		
		# Remove relevant religions
		every_county_in_region = { # Regions to become Hantuist
			region = converter_AUH_out_of_scope_region_hantuist
			save_scope_as = county_check
			every_in_list = {
				list = religions_to_remove
				save_scope_as = remove_religion

				scope:county_check = {
					if = {
						limit = { faith.religion = scope:remove_religion }
						set_county_faith = faith:hantuism
					}

					holder ?= {
						if = {
							limit = { has_variable = irtock3_uncolonized_filler } # Just to double check that the rulers being affected aren't rulers converted from Imperator

							if = {
								limit = { faith.religion = scope:remove_religion }
								set_character_faith = faith:hantuism
							}

							every_courtier = {
								limit = { faith.religion = scope:remove_religion }
								set_character_faith = faith:hantuism
							}

							every_vassal_or_below = {
								if = {
									limit = { faith.religion = scope:remove_religion }
									set_character_faith = faith:hantuism
								}
								every_courtier = {
									limit = { faith.religion = scope:remove_religion }
									set_character_faith = faith:hantuism
								}
							}
						}
					}
				}

				clear_saved_scope = remove_religion
			}
			clear_saved_scope = county_check
		}

		every_county_in_region = { # Regions to become Tolotang
			region = converter_AUH_out_of_scope_region_tolotang
			save_scope_as = county_check
			every_in_list = {
				list = religions_to_remove
				save_scope_as = remove_religion

				scope:county_check = {
					if = {
						limit = { faith.religion = scope:remove_religion }
						set_county_faith = faith:tolotang
					}

					holder ?= {
						if = {
							limit = { has_variable = irtock3_uncolonized_filler } # Just to double check that the rulers being affected aren't rulers converted from Imperator

							if = {
								limit = { faith.religion = scope:remove_religion }
								set_character_faith = faith:tolotang
							}

							every_courtier = {
								limit = { faith.religion = scope:remove_religion }
								set_character_faith = faith:tolotang
							}

							every_vassal_or_below = {
								if = {
									limit = { faith.religion = scope:remove_religion }
									set_character_faith = faith:tolotang
								}
								every_courtier = {
									limit = { faith.religion = scope:remove_religion }
									set_character_faith = faith:tolotang
								}
							}
						}
					}
				}

				clear_saved_scope = remove_religion
			}
			clear_saved_scope = county_check
		}

		every_county_in_region = { # Regions to become Aluk
			region = converter_AUH_out_of_scope_region_aluk
			save_scope_as = county_check
			every_in_list = {
				list = religions_to_remove
				save_scope_as = remove_religion

				scope:county_check = {
					if = {
						limit = { faith.religion = scope:remove_religion }
						set_county_faith = faith:aluk
					}

					holder ?= {
						if = {
							limit = { has_variable = irtock3_uncolonized_filler } # Just to double check that the rulers being affected aren't rulers converted from Imperator

							if = {
								limit = { faith.religion = scope:remove_religion }
								set_character_faith = faith:aluk
							}

							every_courtier = {
								limit = { faith.religion = scope:remove_religion }
								set_character_faith = faith:aluk
							}

							every_vassal_or_below = {
								if = {
									limit = { faith.religion = scope:remove_religion }
									set_character_faith = faith:aluk
								}
								every_courtier = {
									limit = { faith.religion = scope:remove_religion }
									set_character_faith = faith:aluk
								}
							}
						}
					}
				}

				clear_saved_scope = remove_religion
			}
			clear_saved_scope = county_check
		}

		every_county_in_region = { # Regions to become Kaharingan
			region = converter_AUH_out_of_scope_region_kaharingan
			save_scope_as = county_check
			every_in_list = {
				list = religions_to_remove
				save_scope_as = remove_religion

				scope:county_check = {
					if = {
						limit = { faith.religion = scope:remove_religion }
						set_county_faith = faith:kaharingan
					}

					holder ?= {
						if = {
							limit = { has_variable = irtock3_uncolonized_filler } # Just to double check that the rulers being affected aren't rulers converted from Imperator

							if = {
								limit = { faith.religion = scope:remove_religion }
								set_character_faith = faith:kaharingan
							}

							every_courtier = {
								limit = { faith.religion = scope:remove_religion }
								set_character_faith = faith:kaharingan
							}

							every_vassal_or_below = {
								if = {
									limit = { faith.religion = scope:remove_religion }
									set_character_faith = faith:kaharingan
								}
								every_courtier = {
									limit = { faith.religion = scope:remove_religion }
									set_character_faith = faith:kaharingan
								}
							}
						}
					}
				}

				clear_saved_scope = remove_religion
			}
			clear_saved_scope = county_check
		}

		###################
		## Setup Out-of-Scope Indonesia Holdings
		###################
		# Make sure all of the counties only have their capital barony as tribal, all other baronies should have no holding
		every_county_in_region = {
			region = converter_AUH_out_of_scope_indonesia

			every_county_province = {
				if = { # Capital Barony
					limit = { is_county_capital = yes }

					if = {
						limit = {
							NOT = { has_holding_type = tribal_holding }
						}
						set_holding_type = tribal_holding
					}
				}
				else = { # Non-Capital Barony
					if = {
						limit = { has_holding = yes }
						remove_holding = yes
					}
				}
			}
		}
	}
}

IRToCK3_game_start_after_lobby_onaction_effects = {
	effect = {
		every_player = { trigger_event = welcome.1 } # This event so far just notifies the players of the game rules added by the converter, and any relevant mods to use
	}
}
